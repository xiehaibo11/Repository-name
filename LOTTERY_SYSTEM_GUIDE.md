# å½©ç¥¨ç®¡ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬å½©ç¥¨ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„å½©ç¥¨å¼€å¥–å’Œç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§å½©ç¥¨ç±»å‹ï¼ŒåŒ…æ‹¬åˆ†åˆ†æ—¶æ—¶å½©ã€äº”åˆ†æ—¶æ—¶å½©ã€å¿«3ã€PK10ã€11é€‰5ç­‰ã€‚ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç®¡ç†ç«¯å’Œç”¨æˆ·ç«¯APIæ¥å£ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **å¤šå½©ç§æ”¯æŒ**: æ”¯æŒåˆ†åˆ†æ—¶æ—¶å½©ã€å¿«3ã€PK10ã€11é€‰5ç­‰å¤šç§å½©ç¥¨
- **è‡ªåŠ¨å¼€å¥–**: åŸºäºå®šæ—¶ä»»åŠ¡çš„è‡ªåŠ¨å¼€å¥–ç³»ç»Ÿ
- **æ‰‹åŠ¨å¼€å¥–**: ç®¡ç†å‘˜å¯æ‰‹åŠ¨è§¦å‘å¼€å¥–
- **å†å²ç®¡ç†**: è‡ªåŠ¨æ¸…ç†å†å²æ•°æ®ï¼Œä¿æŒç³»ç»Ÿæ€§èƒ½
- **æ•°æ®åˆ†æ**: æä¾›æŠ•æ³¨åˆ†æå’Œç»Ÿè®¡æ•°æ®
- **APIæ¥å£**: å®Œæ•´çš„ç®¡ç†ç«¯å’Œç”¨æˆ·ç«¯API

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç®¡ç†ç«¯ç•Œé¢    â”‚    â”‚   ç”¨æˆ·ç«¯ç•Œé¢    â”‚    â”‚   APIæ¥å£       â”‚
â”‚  (Vue Admin)    â”‚    â”‚  (User App)     â”‚    â”‚  (REST API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              Express.js åç«¯æœåŠ¡                â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚ å½©ç¥¨ç®¡ç†æœåŠ¡ â”‚  â”‚ å¼€å¥–æœåŠ¡    â”‚  â”‚ å®šæ—¶ä»»åŠ¡ â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              PostgreSQL æ•°æ®åº“                  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚ å½©ç§ç®¡ç†    â”‚  â”‚ å¼€å¥–è®°å½•    â”‚  â”‚ ç³»ç»Ÿé…ç½® â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- PostgreSQL >= 12.0
- TypeScript >= 4.0

### 2. å®‰è£…ä¾èµ–

```bash
cd admin-api
npm install
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

```bash
# è¿æ¥åˆ°PostgreSQLæ•°æ®åº“
psql -U your_username -d your_database

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
\i scripts/init-lottery-system.sql
```

### 4. å¯åŠ¨ç³»ç»Ÿ

```bash
# æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
npm run start:lottery

# æ–¹å¼2: æ‰‹åŠ¨å¯åŠ¨
npm run dev
# ç„¶åè°ƒç”¨API: POST /api/admin/lottery/init
```

### 5. éªŒè¯å®‰è£…

è®¿é—® `http://localhost:3001/api` æŸ¥çœ‹APIæ–‡æ¡£ï¼Œç¡®è®¤å½©ç¥¨ç›¸å…³æ¥å£å·²åŠ è½½ã€‚

## ğŸ“Š æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. å½©ç§è¡¨ (lottery_types)
```sql
- id: å½©ç§ID
- name: å½©ç§åç§° (å¦‚: åˆ†åˆ†æ—¶æ—¶å½©)
- code: å½©ç§ä»£ç  (å¦‚: ssc)
- category: å½©ç§ç±»åˆ« (ssc, k3, pk10, 11x5)
- draw_frequency: å¼€å¥–é¢‘ç‡ (minutes, hourly, daily)
- draw_interval: å¼€å¥–é—´éš”(åˆ†é’Ÿ)
- issue_format: æœŸå·æ ¼å¼ (YYYYMMDD{####})
- number_count: å¼€å¥–å·ç ä½æ•°
- number_range_min/max: å·ç èŒƒå›´
```

#### 2. å¥–æœŸè¡¨ (lottery_issues)
```sql
- id: å¥–æœŸID
- lottery_type_id: å½©ç§ID
- issue_no: æœŸå·
- issue_date: æœŸå·æ—¥æœŸ
- start_time: å¼€å§‹æ—¶é—´
- end_time: æˆªæ­¢æ—¶é—´
- draw_time: å¼€å¥–æ—¶é—´
- status: çŠ¶æ€ (pending, closed, drawn, canceled)
```

#### 3. å¼€å¥–ç»“æœè¡¨ (lottery_draws)
```sql
- id: å¼€å¥–ID
- lottery_type_id: å½©ç§ID
- issue_id: å¥–æœŸID
- issue_no: æœŸå·
- draw_numbers: å¼€å¥–å·ç 
- wan_wei, qian_wei, bai_wei, shi_wei, ge_wei: å„ä½æ•°å­—
- sum_value: å’Œå€¼
- sum_big_small: å’Œå€¼å¤§å°
- sum_odd_even: å’Œå€¼å•åŒ
- draw_method: å¼€å¥–æ–¹å¼ (auto, manual, api)
- draw_status: å¼€å¥–çŠ¶æ€ (pending, drawn, error)
```

## ğŸ”§ API æ¥å£

### ç®¡ç†ç«¯æ¥å£

#### å½©ç§ç®¡ç†
```http
GET    /api/admin/lottery/types          # è·å–å½©ç§åˆ—è¡¨
POST   /api/admin/lottery/types          # åˆ›å»ºå½©ç§
PUT    /api/admin/lottery/types/:id      # æ›´æ–°å½©ç§
DELETE /api/admin/lottery/types/:id      # åˆ é™¤å½©ç§
```

#### å¼€å¥–ç®¡ç†
```http
POST   /api/admin/lottery/draw/manual    # æ‰‹åŠ¨å¼€å¥–
GET    /api/admin/lottery/draw/history   # è·å–å¼€å¥–å†å²
POST   /api/admin/lottery/cleanup/history # æ¸…ç†å†å²è®°å½•
```

#### åˆ†åˆ†æ—¶æ—¶å½©ä¸“ç”¨
```http
POST   /api/admin/ssc/start              # å¯åŠ¨ç³»ç»Ÿ
POST   /api/admin/ssc/stop               # åœæ­¢ç³»ç»Ÿ
GET    /api/admin/ssc/status             # è·å–ç³»ç»ŸçŠ¶æ€
GET    /api/admin/ssc/realtime-status    # è·å–å®æ—¶çŠ¶æ€
POST   /api/admin/ssc/manual-draw        # æ‰‹åŠ¨å¼€å¥–
GET    /api/admin/ssc/today-stats        # ä»Šæ—¥ç»Ÿè®¡
```

### ç”¨æˆ·ç«¯æ¥å£

#### åŸºç¡€æ¥å£
```http
GET    /api/lottery/types                # è·å–å½©ç§åˆ—è¡¨
GET    /api/lottery/:code/game-data      # è·å–æ¸¸æˆæ•°æ®
GET    /api/lottery/:code/current-issue  # è·å–å½“å‰æœŸå·
GET    /api/lottery/:code/latest         # è·å–æœ€æ–°å¼€å¥–
GET    /api/lottery/:code/history        # è·å–å¼€å¥–å†å²
GET    /api/lottery/:code/analysis       # è·å–æŠ•æ³¨åˆ†æ
```

## ğŸ² åˆ†åˆ†æ—¶æ—¶å½©è¯¦ç»†è¯´æ˜

### æ¸¸æˆè§„åˆ™

åˆ†åˆ†æ—¶æ—¶å½©æ˜¯åŸºäºæ‚¨æä¾›çš„æ–‡æ¡£å®ç°çš„å®Œæ•´å½©ç¥¨ç³»ç»Ÿï¼š

#### åŸºæœ¬ä¿¡æ¯
- **å¼€å¥–é¢‘ç‡**: æ¯åˆ†é’Ÿä¸€æœŸï¼Œå…¨å¤©24å°æ—¶ä¸é—´æ–­
- **å·ç æ ¼å¼**: 5ä½æ•°å­—ï¼Œæ¯ä½0-9
- **æœŸå·æ ¼å¼**: YYYYMMDD#### (å¦‚: 202501210001)

#### ç©æ³•ç±»å‹

1. **æ•°å­—ç›˜ç©æ³•**
   - ä¸‡ä½ã€åƒä½ã€ç™¾ä½ã€åä½ã€ä¸ªä½ä»»é€‰
   - èµ”ç‡: 9.8å€

2. **åŒé¢ç©æ³•**
   - å¤§å°: 5-9ä¸ºå¤§ï¼Œ0-4ä¸ºå°
   - å•åŒ: 1,3,5,7,9ä¸ºå•ï¼Œ0,2,4,6,8ä¸ºåŒ
   - è´¨åˆ: 1,2,3,5,7ä¸ºè´¨ï¼Œ0,4,6,8,9ä¸ºåˆ
   - æ€»å’Œå¤§å°: 23-45ä¸ºå¤§ï¼Œ0-22ä¸ºå°
   - èµ”ç‡: 1.98å€

3. **é¾™è™ç©æ³•**
   - 10ç§ä½ç½®ç»„åˆæ¯”è¾ƒå¤§å°
   - é¾™/è™èµ”ç‡: 1.98å€ï¼Œå’Œèµ”ç‡: 9å€

4. **è·¨åº¦ç©æ³•**
   - å‰ä¸‰ã€ä¸­ä¸‰ã€åä¸‰è·¨åº¦
   - èµ”ç‡: è·¨åº¦0ä¸º71å€ï¼Œå…¶ä»–æ ¹æ®æ¦‚ç‡è°ƒæ•´

5. **ç‰›ç‰›ç©æ³•**
   - ç‰›ç‰›ç±»å‹: æ— ç‰›åˆ°ç‰›ç‰›
   - ç‰›åŒé¢: ç‰›å¤§å°ã€ç‰›å•åŒç­‰
   - ç‰›æ¢­å“ˆ: äº”æ¡ã€ç‚¸å¼¹ã€è‘«èŠ¦ç­‰

### ç³»ç»Ÿç‰¹æ€§

#### è‡ªåŠ¨å¼€å¥–
- æ¯åˆ†é’Ÿæ•´ç‚¹è‡ªåŠ¨å¼€å¥–
- ä½¿ç”¨cryptoæ¨¡å—ç”Ÿæˆå®‰å…¨éšæœºæ•°
- è‡ªåŠ¨è®¡ç®—å’Œå€¼ã€å¤§å°ã€å•åŒç­‰å±æ€§

#### å†å²ç®¡ç†
- é»˜è®¤ä¿ç•™æœ€æ–°50æœŸè®°å½•
- è‡ªåŠ¨å¤‡ä»½åˆ°å½’æ¡£è¡¨
- æ¯æ—¥å‡Œæ™¨è‡ªåŠ¨æ¸…ç†

#### æ•°æ®åˆ†æ
- å„ä½æ•°å­—åˆ†å¸ƒç»Ÿè®¡
- é¾™è™èµ°åŠ¿åˆ†æ
- è·¨åº¦åˆ†å¸ƒç»Ÿè®¡
- å’Œå€¼è¶‹åŠ¿åˆ†æ

## ğŸ› ï¸ é…ç½®è¯´æ˜

### ç³»ç»Ÿé…ç½® (lottery_configè¡¨)

```sql
-- å†å²è®°å½•ä¿ç•™æœŸæ•°
history_retention_count: 50

-- è‡ªåŠ¨æ¸…ç†å¼€å…³
auto_cleanup_enabled: true

-- æ¸…ç†æ—¶é—´è®¾ç½®
cleanup_time_hour: 0
cleanup_time_minute: 5

-- éšæœºæ•°ç”Ÿæˆé…ç½®
random_seed_sources: ["crypto", "os", "hardware"]

-- å¼€å¥–éªŒè¯å¼€å…³
draw_validation_enabled: true

-- æœ€å¤§å¼€å¥–å°è¯•æ¬¡æ•°
max_draw_attempts: 100
```

### å®šæ—¶ä»»åŠ¡é…ç½®

ç³»ç»ŸåŒ…å«ä»¥ä¸‹å®šæ—¶ä»»åŠ¡ï¼š

1. **è‡ªåŠ¨å¼€å¥–**: æ¯åˆ†é’Ÿæ‰§è¡Œ (`* * * * *`)
2. **ç”ŸæˆæœŸå·**: æ¯æ—¥00:05æ‰§è¡Œ (`5 0 * * *`)
3. **æ¸…ç†å†å²**: æ¯æ—¥00:10æ‰§è¡Œ (`10 0 * * *`)
4. **å¥åº·æ£€æŸ¥**: æ¯å°æ—¶æ‰§è¡Œ (`0 * * * *`)

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿç›‘æ§

#### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:3001/api/admin/ssc/status

# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
SELECT check_lottery_data_integrity();

# è·å–ç»Ÿè®¡ä¿¡æ¯
SELECT get_lottery_statistics('ssc');
```

#### æ€§èƒ½ç›‘æ§
- ç›‘æ§å¼€å¥–è€—æ—¶
- ç›‘æ§æ•°æ®åº“è¿æ¥
- ç›‘æ§å®šæ—¶ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- ç›‘æ§å†å²æ•°æ®å¢é•¿

### ç»´æŠ¤æ“ä½œ

#### æ‰‹åŠ¨æ¸…ç†å†å²æ•°æ®
```sql
SELECT cleanup_lottery_history_records(50, true);
```

#### é‡æ–°ç”ŸæˆæœŸå·
```bash
curl -X POST http://localhost:3001/api/admin/ssc/regenerate-issues
```

#### æ‰‹åŠ¨å¼€å¥–
```bash
curl -X POST http://localhost:3001/api/admin/ssc/manual-draw \
  -H "Content-Type: application/json" \
  -d '{"issueId": 123, "numbers": [1,2,3,4,5]}'
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### éšæœºæ•°å®‰å…¨
- ä½¿ç”¨Node.js cryptoæ¨¡å—ç”Ÿæˆå®‰å…¨éšæœºæ•°
- æ”¯æŒå¤šé‡éšæœºæºéªŒè¯
- å®æ–½éšæœºæ€§æ£€æµ‹ç®—æ³•

### æ•°æ®å®‰å…¨
- æ‰€æœ‰å¼€å¥–è®°å½•ä¸å¯ç¯¡æ”¹
- å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•
- æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

### è®¿é—®æ§åˆ¶
- JWTè®¤è¯ä¿æŠ¤ç®¡ç†æ¥å£
- ç”¨æˆ·ç«¯æ¥å£æ— éœ€è®¤è¯
- æ“ä½œæƒé™åˆ†çº§ç®¡ç†

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç³»ç»Ÿæ— æ³•å¯åŠ¨**
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥
   - ç¡®è®¤è¡¨ç»“æ„å®Œæ•´
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **å¼€å¥–å¤±è´¥**
   - æ£€æŸ¥æœŸå·æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤å¼€å¥–æ—¶é—´æ˜¯å¦åˆ°è¾¾
   - æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çŠ¶æ€

3. **æ•°æ®ä¸ä¸€è‡´**
   - è¿è¡Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
   - æ¸…ç†å­¤ç«‹è®°å½•
   - é‡æ–°ç”Ÿæˆç¼ºå¤±æ•°æ®

### æ—¥å¿—æŸ¥çœ‹
```sql
-- æŸ¥çœ‹å¼€å¥–æ—¥å¿—
SELECT * FROM lottery_logs 
WHERE operation = 'auto_draw' 
ORDER BY created_at DESC LIMIT 10;

-- æŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¥å¿—
SELECT * FROM lottery_scheduler_logs 
ORDER BY start_time DESC LIMIT 10;
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- ç³»ç»Ÿç‰ˆæœ¬å’Œç¯å¢ƒä¿¡æ¯
- é”™è¯¯æ—¥å¿—å’Œå †æ ˆè·Ÿè¸ª
- é‡ç°é—®é¢˜çš„æ­¥éª¤
- æ•°æ®åº“çŠ¶æ€å’Œé…ç½®

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2025-01-21  
**ä½œè€…**: ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
